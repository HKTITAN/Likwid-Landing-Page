<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Service Test - Secure Configuration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #495057;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        .image-result {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ AI Service Test - Secure Configuration</h1>
        <p>This page tests the AI service with the new secure configuration system.</p>

        <!-- API Key Management Section -->
        <div class="test-section">
            <div id="api-key-manager"></div>
        </div>

        <!-- Configuration Status -->
        <div class="test-section">
            <h3>üìä Configuration Status</h3>
            <button onclick="checkStatus()">Check Status</button>
            <button onclick="testConnection()">Test API Connection</button>
            <div id="status-result" class="result info" style="display: none;"></div>
        </div>

        <!-- Content Generation Test -->
        <div class="test-section">
            <h3>üìù Content Generation Test</h3>
            <input type="text" id="content-prompt" placeholder="Enter a topic for content generation (e.g., 'manufacturing automation')" value="manufacturing automation benefits">
            <button onclick="testContentGeneration()">Generate Content</button>
            <div id="content-result" class="result" style="display: none;"></div>
        </div>

        <!-- Image Generation Test -->
        <div class="test-section">
            <h3>üñºÔ∏è Image Generation Test</h3>
            <input type="text" id="image-prompt" placeholder="Enter a prompt for image generation" value="modern manufacturing facility with automated robots">
            <button onclick="testImageGeneration()">Generate Image</button>
            <div id="image-result" class="result" style="display: none;"></div>
        </div>

        <!-- Complete Content Generation Test -->
        <div class="test-section">
            <h3>üöÄ Complete Content Generation Test</h3>
            <input type="text" id="complete-prompt" placeholder="Enter a topic for complete blog post generation" value="Industry 4.0 implementation">
            <button onclick="testCompleteContent()">Generate Complete Blog Post</button>
            <div id="complete-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- Load required scripts -->
    <script src="config-manager.js"></script>
    <script src="api-key-manager.js"></script>
    <script src="ai-service.js"></script>

    <script>
        let aiService;

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîÑ Initializing AI Service Test...');
            
            // Initialize API key manager
            apiKeyManager.init();
            
            // Initialize AI service
            aiService = new AIService();
            apiKeyManager.setAIService(aiService);
            
            console.log('‚úÖ AI Service Test initialized');
            
            // Show initial status
            checkStatus();
        });

        // Check configuration status
        function checkStatus() {
            const resultDiv = document.getElementById('status-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            
            try {
                const status = aiService.getApiKeyStatus();
                const configStatus = configManager.exportConfig();
                
                resultDiv.textContent = `Configuration Status:
API Key Status: ${status.isValid ? '‚úÖ Valid' : '‚ùå Invalid/Missing'}
API Key (Masked): ${status.apiKeyMasked || 'Not set'}
Last Updated: ${status.lastUpdated ? new Date(status.lastUpdated).toLocaleString() : 'Never'}
Version: ${status.version}

Configuration Manager:
Has API Key: ${configStatus.hasApiKey ? 'Yes' : 'No'}
API Key (Masked): ${configStatus.apiKeyMasked || 'Not set'}
Last Updated: ${configStatus.lastUpdated ? new Date(configStatus.lastUpdated).toLocaleString() : 'Never'}`;
                
                resultDiv.className = status.isValid ? 'result success' : 'result error';
            } catch (error) {
                resultDiv.textContent = `Error checking status: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // Test API connection
        async function testConnection() {
            const resultDiv = document.getElementById('status-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Testing API connection...';
            
            try {
                const result = await aiService.testApiConnection();
                
                resultDiv.textContent = `API Connection Test:
Status: ${result.success ? '‚úÖ Success' : '‚ùå Failed'}
Message: ${result.message}
Response: ${result.response || 'N/A'}
Tested At: ${new Date(result.testedAt).toLocaleString()}`;
                
                resultDiv.className = result.success ? 'result success' : 'result error';
            } catch (error) {
                resultDiv.textContent = `API connection test failed: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // Test content generation
        async function testContentGeneration() {
            const prompt = document.getElementById('content-prompt').value.trim();
            const resultDiv = document.getElementById('content-result');
            
            if (!prompt) {
                alert('Please enter a prompt for content generation');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Generating content...';
            
            try {
                const content = await aiService.generateContent(`Write a brief paragraph about: ${prompt}`, 500);
                
                resultDiv.textContent = `Generated Content:
Prompt: ${prompt}
Response: ${content}`;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = `Content generation failed: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // Test image generation
        async function testImageGeneration() {
            const prompt = document.getElementById('image-prompt').value.trim();
            const resultDiv = document.getElementById('image-result');
            
            if (!prompt) {
                alert('Please enter a prompt for image generation');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Generating image...';
            
            try {
                const imageResult = await aiService.generateImage(prompt);
                
                resultDiv.innerHTML = `
                    <div>Image Generation Result:</div>
                    <div>Prompt: ${prompt}</div>
                    <div>Description: ${imageResult.description}</div>
                    <img src="${imageResult.imageUrl}" alt="Generated image" class="image-result">
                `;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = `Image generation failed: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // Test complete content generation
        async function testCompleteContent() {
            const prompt = document.getElementById('complete-prompt').value.trim();
            const resultDiv = document.getElementById('complete-result');
            
            if (!prompt) {
                alert('Please enter a topic for complete content generation');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Generating complete blog post... This may take a few minutes.';
            
            try {
                const completeContent = await aiService.generateCompleteContent(prompt);
                
                resultDiv.innerHTML = `
                    <div><strong>Complete Content Generation Result:</strong></div>
                    <div><strong>Original Input:</strong> ${completeContent.originalInput}</div>
                    <div><strong>Refined Topic:</strong> ${completeContent.refinedBrief.refined_topic}</div>
                    <div><strong>Blog Title:</strong> ${completeContent.blogPost.title}</div>
                    <div><strong>Meta Description:</strong> ${completeContent.blogPost.meta_description}</div>
                    <div><strong>Keywords:</strong> ${completeContent.blogPost.keywords}</div>
                    <div><strong>SEO Score:</strong> ${completeContent.seoAnalysis.totalScore}/100</div>
                    <div><strong>Read Time:</strong> ${completeContent.blogPost.estimatedReadTime} minutes</div>
                    <div><strong>Generated At:</strong> ${new Date(completeContent.generatedAt).toLocaleString()}</div>
                    ${completeContent.imageData.url ? `<img src="${completeContent.imageData.url}" alt="${completeContent.imageData.altText}" class="image-result">` : ''}
                `;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.textContent = `Complete content generation failed: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }
    </script>
</body>
</html>